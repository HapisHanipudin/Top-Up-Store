import{u as L,a as O,b as F,d as N,e as T,f as n,g as l,t as d,h as $,w as P,i as x,F as y,j as _,k as p,l as f,v as z,m as S,n as h,p as m,q as b,s as A,x as E,y as q,z as U,A as G,B as J,o as r,C as Q,R as H,D as K,E as j,G as D}from"./index-MAQLLkW2.js";const W={class:"container flex flex-col gap-3 p-4"},X={class:"flex flex-grow justify-between"},Y={class:"text-3xl font-bold mt-3"},Z={class:"flex flex-col w-full lg:flex-row gap-3"},ee={class:"lg:w-1/3 w-full flex lg:flex-col gap-3"},te=["src"],le={class:"bg-slate-700 p-3 max-lg:flex-grow rounded-md"},se={class:"flex flex-col lg:w-2/3 gap-3"},oe={action:"#",class:"flex flex-col gap-3"},ae={class:"flex flex-col gap-3"},ne=["for"],re=["type","placeholder","id","onUpdate:modelValue"],ce=["id","onUpdate:modelValue"],ie={selected:"",value:""},de={class:"flex flex-col gap-3 bg-slate-700 p-3 rounded-xl"},ue=l("label",{for:"currency"},"Currency",-1),ge={class:"flex gap-3 py-4 overflow-x-scroll"},pe={class:"flex gap-3 flex-nowrap"},fe=["value"],me=["src"],ve=["for"],ye={key:0,class:"flex flex-col relative w-4/12 p-3 rounded-xl items-center text-center bg-slate-600"},_e=l("label",{class:"text-lg"},"No items found",-1),xe=[_e],he={class:"flex flex-col gap-3"},be=l("label",{for:"item"},"Item",-1),we={key:0,class:"flex gap-3 flex-wrap"},ke=["value","onUpdate:modelValue"],Me=["src"],qe=["for"],Re=["for"],Ve={key:1,class:"bg-slate-700 p-3 rounded-xl"},Ce={class:"flex gap-3"},Ne={class:"flex flex-col grow gap-3"},Se=l("label",{for:"phoneNumber"},"Phone number",-1),Ee={class:"flex gap-3 w-full bg-slate-700 p-3 rounded-xl"},Ue={class:"flex flex-col grow gap-3"},je=l("label",{for:"qty"},"Quantity",-1),De=["selected","value"],Le={__name:"ItemView",setup(Ie){const v=L(),w=O(),R=F(),V=(s,a,e)=>{for(const o of e){const c=s[o],i=a[o];if(typeof c=="object"&&typeof i=="object"){if(!areValuesEqual(c,i,Object.keys(c)))return!1}else if(c!==i)return!1}return!0},t=N({game:{products:[]},currency:{},item:{},loginMethod:{},qty:1,user:""}),I=async()=>{if(!t.value.currency||!t.value.item||!t.value.loginMethod){alert("Please select currency and item");return}const s=t.value,a=h(b,"cart"),e=m(b,"game",w.params.id),o=m(e,"products",t.value.currency.id),c=m(o,"items",t.value.item.id);s.item=c,s.game=e,s.currency=o,s.user=v.user.uid,s.timestamp=A();try{const i=await q(a,E("user","==",v.user.uid),E("item","==",c));let M=!1;for(const u of i.docs){const g=u.data();if(console.log(JSON.stringify(g.loginMethod)),console.log(JSON.stringify(s.loginMethod)),console.log(V(g.loginMethod,s.loginMethod,Object.keys(s.loginMethod))),V(g.loginMethod,s.loginMethod,Object.keys(s.loginMethod)))if(g.qty+s.qty<=5){await U(u.ref,{qty:g.qty+s.qty}),R.push("/cart"),M=!0;break}else{M=!0,alert("Maximum quantity reached for this item and account");return}else continue}if(!M){const u=await G(a,s),g=m(a,u.id);await U(u,{cartId:u.id},{merge:!0}),R.push("/cart")}}catch(i){console.error("Error processing cart:",i),alert("Error processing cart. Please try again.")}},k=N({items:[]}),B=async()=>{try{const s=m(b,"game",w.params.id),a=await J(s);t.value.game=a.data(),t.value.loginMethod=t.value.game.method.reduce((c,i)=>(c[i.name]="",c),{});const e=h(s,"products"),o=await q(e);t.value.game.products=o.docs.map(c=>c.data()),t.value.game.products.length>0&&(t.value.currency=t.value.game.products[0],C())}catch(s){console.error("Error fetching game details:",s)}},C=async()=>{try{const s=h(b,"game",w.params.id,"products"),a=m(s,t.value.currency.id),e=h(a,"items"),o=await q(e);k.value.items=o.docs.map(c=>c.data())}catch(s){console.error("Error fetching items:",s)}};return T(()=>{B()}),(s,a)=>(r(),n("div",W,[l("div",X,[l("h1",Y,d(t.value.game.name),1),$(x(H),{to:"/products",class:"bg-slate-700 p-3 rounded-xl"},{default:P(()=>[Q("Back")]),_:1})]),l("div",Z,[l("div",ee,[l("img",{class:"max-lg:w-40",src:t.value.game.image,alt:""},null,8,te),l("div",le,[l("p",null,d(t.value.game.desc),1)])]),l("div",se,[l("form",oe,[t.value.game.method?(r(!0),n(y,{key:0},_(t.value.game.method,e=>(r(),n("div",ae,[l("label",{for:e.name},d(e.name),9,ne),e.type!=="select"?f((r(),n("input",{key:0,type:e.type,placeholder:`Enter your ${e.name}`,class:"bg-slate-700 p-3 rounded-xl text-lg",id:e.name,"onUpdate:modelValue":o=>t.value.loginMethod[e.name]=o},null,8,re)),[[K,t.value.loginMethod[e.name]]]):p("",!0),e.type==="select"?f((r(),n("select",{key:1,class:"bg-slate-700 p-3 rounded-xl text-lg",id:e.name,"onUpdate:modelValue":o=>t.value.loginMethod[e.name]=o},[l("option",ie,"Select "+d(e.name),1),(r(!0),n(y,null,_(e.options,o=>(r(),n("option",{key:o},d(o),1))),128))],8,ce)),[[S,t.value.loginMethod[e.name]]]):p("",!0)]))),256)):p("",!0),l("div",de,[ue,l("div",ge,[l("div",pe,[(r(!0),n(y,null,_(t.value.game.products,e=>(r(),n("div",{key:e.id,class:j([t.value.currency.id==e.id?"bg-blue-500 ":"bg-slate-600","flex flex-col hover:bg-slate-500 hover:scale-110 duration-300 gap-2 relative min-w-44 p-3 rounded-xl justify-center items-center text-center"])},[f(l("input",{onChange:C,value:e,"onUpdate:modelValue":a[0]||(a[0]=o=>t.value.currency=o),class:"absolute opacity-0 cursor-pointer w-full h-full top-0 left-0",type:"radio",name:"currency",id:"currency"},null,40,fe),[[D,t.value.currency]]),l("img",{src:e.image,alt:""},null,8,me),l("label",{class:"text-lg",for:"category_"+e},d(e.name),9,ve)],2))),128)),t.value.game.products.length==0?(r(),n("div",ye,xe)):p("",!0)])])]),l("div",he,[be,k.value.items.length>0?(r(),n("div",we,[(r(!0),n(y,null,_(k.value.items,e=>(r(),n("div",{key:e.id,class:j([t.value.item.id==e.id?"bg-blue-500 ":"bg-slate-600","flex hover:bg-slate-500 hover:scale-110 duration-300 flex-col relative lg:w-[32%] w-[49%] p-3 rounded-xl items-center text-center"])},[f(l("input",{value:e,"onUpdate:modelValue":o=>t.value.item=o,class:"absolute opacity-0 cursor-pointer w-full h-full top-0 left-0",type:"radio",name:"currency",id:"currency"},null,8,ke),[[D,t.value.item]]),l("img",{src:t.value.currency.image,alt:""},null,8,Me),l("label",{class:"text-lg",for:"category_"+e.id},d(e.name),9,qe),l("label",{class:"text-lg",for:"category_"+e.id},"Rp "+d(e.price.toLocaleString()),9,Re)],2))),128))])):(r(),n("div",Ve,"No item added"))]),l("div",Ce,[l("div",Ne,[Se,l("div",Ee,[f(l("input",{type:"text",class:"bg-slate-100 p-3 flex grow text-black rounded-lg text-lg",id:"phoneNumber","onUpdate:modelValue":a[1]||(a[1]=e=>t.value.phoneNumber=e)},null,512),[[z,t.value.phoneNumber]])])]),l("div",Ue,[je,f(l("select",{name:"qty","onUpdate:modelValue":a[2]||(a[2]=e=>t.value.qty=e),class:"bg-slate-700 p-6 text-lg rounded-xl",id:"qty"},[(r(),n(y,null,_(5,e=>l("option",{selected:t.value.qty==e?"selected":"",value:e,key:e},d(e),9,De)),64))],512),[[S,t.value.qty]])])]),l("div",null,[x(v).isLoggedIn?(r(),n("button",{key:0,type:"button",onClick:I,class:"bg-slate-700 text-xl p-3 rounded-xl"},"Add to cart")):p("",!0),x(v).isLoggedIn?p("",!0):(r(),n("button",{key:1,type:"button",onClick:a[3]||(a[3]=e=>x(v).openModal("login")),class:"bg-slate-700 text-xl p-3 rounded-xl"},"Log In First"))])])])])]))}};export{Le as default};
