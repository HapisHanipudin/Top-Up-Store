import{u as L,a as O,b as F,d as N,e as T,f as n,g as s,t as d,h as $,w as P,i as x,F as y,j as _,k as p,l as f,v as z,m as S,n as h,p as m,q as b,s as A,x as E,y as q,z as U,A as G,B as J,o as r,C as Q,R as H,D as K,E as j,G as D}from"./index-w3Ezt-_Y.js";const W={class:"container flex flex-col gap-3 p-4"},X={class:"flex flex-grow justify-between"},Y={class:"text-3xl font-bold mt-3"},Z={class:"flex flex-col lg:flex-row gap-3"},ee={class:"lg:w-96 w flex lg:flex-col gap-3"},te=["src"],se={class:"bg-slate-700 p-3 max-lg:flex-grow rounded-md"},oe={class:"flex flex-col w-full"},le={action:"#",class:"flex flex-col gap-3"},ae={class:"flex flex-col gap-3"},ne=["for"],re=["type","placeholder","id","onUpdate:modelValue"],ce=["id","onUpdate:modelValue"],ie={selected:"",value:""},de={class:"flex flex-col gap-3 bg-slate-700 p-3 rounded-xl"},ue=s("label",{for:"currency"},"Currency",-1),ge={class:"flex gap-3"},pe=["value"],fe=["src"],me=["for"],ve={key:0,class:"flex flex-col relative w-4/12 p-3 rounded-xl items-center text-center bg-slate-600"},ye=s("label",{class:"text-lg"},"No items found",-1),_e=[ye],xe={class:"flex flex-col gap-3"},he=s("label",{for:"item"},"Item",-1),be={key:0,class:"flex gap-3"},we=["value","onUpdate:modelValue"],ke=["src"],Me=["for"],qe=["for"],Re={key:1,class:"bg-slate-700 p-3 rounded-xl"},Ve={class:"flex gap-3"},Ce={class:"flex flex-col grow gap-3"},Ne=s("label",{for:"phoneNumber"},"Phone number",-1),Se={class:"flex gap-3 w-full bg-slate-700 p-3 rounded-xl"},Ee={class:"flex flex-col grow gap-3"},Ue=s("label",{for:"qty"},"Quantity",-1),je=["selected","value"],Be={__name:"ItemView",setup(De){const v=L(),w=O(),R=F(),V=(o,a,e)=>{for(const l of e){const c=o[l],i=a[l];if(typeof c=="object"&&typeof i=="object"){if(!areValuesEqual(c,i,Object.keys(c)))return!1}else if(c!==i)return!1}return!0},t=N({game:{products:[]},currency:{},item:{},loginMethod:{},qty:1,user:""}),I=async()=>{if(!t.value.currency||!t.value.item||!t.value.loginMethod){alert("Please select currency and item");return}const o=t.value,a=h(b,"cart"),e=m(b,"game",w.params.id),l=m(e,"products",t.value.currency.id),c=m(l,"items",t.value.item.id);o.item=c,o.game=e,o.currency=l,o.user=v.user.uid,o.timestamp=A();try{const i=await q(a,E("user","==",v.user.uid),E("item","==",c));let M=!1;for(const u of i.docs){const g=u.data();if(console.log(JSON.stringify(g.loginMethod)),console.log(JSON.stringify(o.loginMethod)),console.log(V(g.loginMethod,o.loginMethod,Object.keys(o.loginMethod))),V(g.loginMethod,o.loginMethod,Object.keys(o.loginMethod)))if(g.qty+o.qty<=5){await U(u.ref,{qty:g.qty+o.qty}),R.push("/cart"),M=!0;break}else{M=!0,alert("Maximum quantity reached for this item and account");return}else continue}if(!M){const u=await G(a,o),g=m(a,u.id);await U(u,{cartId:u.id},{merge:!0}),R.push("/cart")}}catch(i){console.error("Error processing cart:",i),alert("Error processing cart. Please try again.")}},k=N({items:[]}),B=async()=>{try{const o=m(b,"game",w.params.id),a=await J(o);t.value.game=a.data(),t.value.loginMethod=t.value.game.method.reduce((c,i)=>(c[i.name]="",c),{});const e=h(o,"products"),l=await q(e);t.value.game.products=l.docs.map(c=>c.data()),t.value.game.products.length>0&&(t.value.currency=t.value.game.products[0],C())}catch(o){console.error("Error fetching game details:",o)}},C=async()=>{try{const o=h(b,"game",w.params.id,"products"),a=m(o,t.value.currency.id),e=h(a,"items"),l=await q(e);k.value.items=l.docs.map(c=>c.data())}catch(o){console.error("Error fetching items:",o)}};return T(()=>{B()}),(o,a)=>(r(),n("div",W,[s("div",X,[s("h1",Y,d(t.value.game.name),1),$(x(H),{to:"/products",class:"bg-slate-700 p-3 rounded-xl"},{default:P(()=>[Q("Back")]),_:1})]),s("div",Z,[s("div",ee,[s("img",{class:"max-lg:w-40",src:t.value.game.image,alt:""},null,8,te),s("div",se,[s("p",null,d(t.value.game.desc),1)])]),s("div",oe,[s("form",le,[t.value.game.method?(r(!0),n(y,{key:0},_(t.value.game.method,e=>(r(),n("div",ae,[s("label",{for:e.name},d(e.name),9,ne),e.type!=="select"?f((r(),n("input",{key:0,type:e.type,placeholder:`Enter your ${e.name}`,class:"bg-slate-700 p-3 rounded-xl text-lg",id:e.name,"onUpdate:modelValue":l=>t.value.loginMethod[e.name]=l},null,8,re)),[[K,t.value.loginMethod[e.name]]]):p("",!0),e.type==="select"?f((r(),n("select",{key:1,class:"bg-slate-700 p-3 rounded-xl text-lg",id:e.name,"onUpdate:modelValue":l=>t.value.loginMethod[e.name]=l},[s("option",ie,"Select "+d(e.name),1),(r(!0),n(y,null,_(e.options,l=>(r(),n("option",{key:l},d(l),1))),128))],8,ce)),[[S,t.value.loginMethod[e.name]]]):p("",!0)]))),256)):p("",!0),s("div",de,[ue,s("div",ge,[(r(!0),n(y,null,_(t.value.game.products,e=>(r(),n("div",{key:e.id,class:j([t.value.currency.id==e.id?"bg-blue-500 ":"bg-slate-600","flex flex-col hover:bg-slate-500 hover:scale-110 duration-300 gap-2 relative w-4/12 p-3 rounded-xl justify-center items-center text-center"])},[f(s("input",{onChange:C,value:e,"onUpdate:modelValue":a[0]||(a[0]=l=>t.value.currency=l),class:"absolute opacity-0 cursor-pointer w-full h-full top-0 left-0",type:"radio",name:"currency",id:"currency"},null,40,pe),[[D,t.value.currency]]),s("img",{src:e.image,alt:""},null,8,fe),s("label",{class:"text-lg",for:"category_"+e},d(e.name),9,me)],2))),128)),t.value.game.products.length==0?(r(),n("div",ve,_e)):p("",!0)])]),s("div",xe,[he,k.value.items.length>0?(r(),n("div",be,[(r(!0),n(y,null,_(k.value.items,e=>(r(),n("div",{key:e.id,class:j([t.value.item.id==e.id?"bg-blue-500 ":"bg-slate-600","flex hover:bg-slate-500 hover:scale-110 duration-300 flex-col relative w-4/12 p-3 rounded-xl items-center text-center"])},[f(s("input",{value:e,"onUpdate:modelValue":l=>t.value.item=l,class:"absolute opacity-0 cursor-pointer w-full h-full top-0 left-0",type:"radio",name:"currency",id:"currency"},null,8,we),[[D,t.value.item]]),s("img",{src:t.value.currency.image,alt:""},null,8,ke),s("label",{class:"text-lg",for:"category_"+e.id},d(e.name),9,Me),s("label",{class:"text-lg",for:"category_"+e.id},"Rp "+d(e.price.toLocaleString()),9,qe)],2))),128))])):(r(),n("div",Re,"No item added"))]),s("div",Ve,[s("div",Ce,[Ne,s("div",Se,[f(s("input",{type:"text",class:"bg-slate-100 p-3 flex grow text-black rounded-lg text-lg",id:"phoneNumber","onUpdate:modelValue":a[1]||(a[1]=e=>t.value.phoneNumber=e)},null,512),[[z,t.value.phoneNumber]])])]),s("div",Ee,[Ue,f(s("select",{name:"qty","onUpdate:modelValue":a[2]||(a[2]=e=>t.value.qty=e),class:"bg-slate-700 p-6 text-lg rounded-xl",id:"qty"},[(r(),n(y,null,_(5,e=>s("option",{selected:t.value.qty==e?"selected":"",value:e,key:e},d(e),9,je)),64))],512),[[S,t.value.qty]])])]),s("div",null,[x(v).isLoggedIn?(r(),n("button",{key:0,type:"button",onClick:I,class:"bg-slate-700 text-xl p-3 rounded-xl"},"Add to cart")):p("",!0),x(v).isLoggedIn?p("",!0):(r(),n("button",{key:1,type:"button",onClick:a[3]||(a[3]=e=>x(v).openModal("login")),class:"bg-slate-700 text-xl p-3 rounded-xl"},"Log In First"))])])])])]))}};export{Be as default};
